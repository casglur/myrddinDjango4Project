{% extends "myrddin/base.html" %}
{% block breadcrumb_title %}

<a href="/">home</a> / <a href="{{ app_url_path }}/poems">poems</a>/ <strong>{% for l in poems %}{{ l.title }}{% endfor %}</strong>

{% endblock %}

{% block title %}
{% for l in poems %}{{ l.title }}{% endfor %}
{% endblock %}

{% block content %}
	
	<script language="JavaScript">
	
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	   if (this.readyState == 4 && this.status == 200) {
	       myFunction(this);
	   }
	};
	xhttp.open("GET", "https://dh-existdb.swansea.ac.uk/exist/apps/myrddin/data?_query=declare%20namespace%20tei=%22http://www.tei-c.org/ns/1.0%22;doc(%27/db/apps/myrddin/data/myrddin_{{ myrddin_id }}.xml%27)//tei:graphic[@rend=%22facstab%22]/", true);
	xhttp.send();
	
	function myFunction(xml) {
		var facs = [];
		var pb = document.querySelector("pb-facsimile"); 
	    var x, i, xmlDoc, txt;
	    
	    xmlDoc = xml.responseXML;
	    txt = "";
	    x = xmlDoc.getElementsByTagName('graphic');
	    for (i = 0; i < x.length; i++) {
	    	facs.push(x[i].getAttribute('url'));
	    }
	    pb.setAttribute("facsimiles", JSON.stringify(facs, null, 4));
	    console.log(facs);
	}
	</script>
</div>
<div class="poems-container">
	<pb-page endpoint="https://dh-existdb.swansea.ac.uk/exist/apps/emco" emit="myrddin" class="embedded">
	    <pb-document id="myrddin" path="myrddin{{ myrddin_id }}.xml" odd="myrddin1">
	    	<h3>Please wait - poems transcript is loading...</h3>
    		<img src="/static/img/icons/Blocks-1s-200px.gif" />
    	</pb-document>
    	<pb-progress></pb-progress>
	    <pb-view src="myrddin" xpath="//teiHeader/fileDesc/titleStmt/title" emit="myrddin" subscribe="myrddin">
	        <pb-param name="header" value="short">
	    </pb-param></pb-view>
	    <pb-view class="transcription" src="myrddin" view="single" emit="myrddin" subscribe="myrddin" append-footnotes="yes" disable-history="" load-css="transform/myrddin1.css">
	    {% if keyword %}
	    <pb-param name="query" value="{{ keyword }}" />
	    {% endif %}
	    </pb-view>	    
	    </pb-view>
	</pb-page>
</div>
<hr>
<div>
	<p><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>. | <a href="/copyright/" target="blank">Licensing and Copyright</a></p>
</div>

{% endblock %}

{% block poems-metadata %}
	{% include "myrddin/poems-detail-card.html" %}
	<br/>
	{% include "myrddin/poems-archive-info.html" %} 
	<br/>
	{% include "myrddin/poems-location-detail.html" %}
{% endblock %}
